# Permission Model
## 一問一答フォーム作成・分析ツール（Phase1）

---

# 1. 本書の目的

本書は、本システムにおける権限モデル（アクセス制御）を定義する。

Google Workspace（Googleフォーム／スプレッドシート／ドライブ）を前提とし、
以下を達成することを目的とする：

- 生徒がスプレッドシート（データストア）に直接アクセスできない
- 教師のみが問題・クイズ・集計データを編集できる
- Googleアカウントを用いた識別・アクセス制御を成立させる
- 誤共有・権限事故を最小化する運用を確立する

---

# 2. アクターとロール

## 2.1 ロール一覧

| ロール | 概要 |
|-------|------|
| Teacher | 問題作成、クイズ作成、フォーム生成、集計閲覧、運用管理 |
| Student | フォーム回答のみ（データ編集不可） |
| (Optional) Admin | 運用者（複数教師管理など）。MVPでは必須としない |

---

# 3. 保護対象リソース（Assets）

| 資産 | 例 | 機密性 |
|------|----|--------|
| 問題データ | Questions | 高 |
| クイズ定義 | Quizzes / QuizQuestions | 高 |
| 回答・成績データ | Attempts / AttemptAnswers | 最高（個人情報含む可能性） |
| 集計結果 | Aggregates / 集計シート | 高 |
| フォーム | Google Form | 中（公開範囲による） |
| ソースコード | GAS / GitHub | 中 |
| ドキュメント | docs/ | 低〜中（内部仕様） |

---

# 4. 基本ポリシー（Access Control Policy）

## 4.1 原則

1. 最小権限（Least Privilege）
2. データストア（スプレッドシート）は生徒に共有しない
3. フォームは「回答者のみに限定」し、Googleアカウントで識別する
4. 教師の操作ミスによる誤共有を防ぐ（共有経路を固定する）

---

# 5. Googleフォームのアクセス制御

## 5.1 基本設定（推奨）

- 回答者をGoogleアカウントに限定する
- 必要に応じて「ドメイン内ユーザーのみ」に限定する（利用組織が同一ドメインの場合）
- 「メールアドレスを収集する」を有効化する（userIdとして利用）
- 複数回回答を許可する（要件より）

## 5.2 期限運用

- 期限は任意設定可能
- 期限はフォーム側または採点／集計側で制御する（要件で確定）
  - MVPではフォーム設定優先とする

---

# 6. スプレッドシート（データストア）のアクセス制御

## 6.1 所有者と共有

- スプレッドシート所有者：Teacher（または運用上の管理アカウント）
- 編集権限：Teacherのみ
- 閲覧権限：Teacherのみ（原則）
- Studentへは共有しない

## 6.2 回答シート（フォーム回答）

- フォーム回答はスプレッドシートに保存されるが、
  そのスプレッドシートはStudentへ共有しないため、
  Studentは回答データへ直接アクセスできない

---

# 7. GAS実行権限

## 7.1 実行主体

- フォーム送信トリガー（onFormSubmit）によりGASが実行される
- スクリプトはスプレッドシート所有者（Teacher）の権限で動作する想定

## 7.2 原則

- 外部公開（Anyone）での実行は行わない（MVPではWebアプリを採用しないため）
- GASはデータストアの変更権限を持つため、実装での入力検証を重視する

---

# 8. GitHub（ソース管理）のアクセス制御

## 8.1 公開範囲

- 原則：Privateリポジトリ
- 公開が必要な場合：docsに個人情報やスクリプトID等を含めない

## 8.2 秘密情報の取り扱い

- `.clasp.json` はGit管理しない（.gitignore）
- 認証情報、APIキー、スクリプトID等はリポジトリへコミットしない

---

# 9. ログ・通知の権限

## 9.1 ログ

- エラーは教師のみ閲覧可能なログ領域に出力する
  - 例：Logsシート、Stackdriver Logging（Apps Scriptのログ）

## 9.2 通知

- トリガー失敗時は教師へ通知する
  - 例：GmailAppによるメール通知（教師アドレス固定）

---

# 10. 例外と将来拡張

## 10.1 生徒への結果返却

MVPでは教師向け閲覧が中心だが、
将来、生徒へ結果を返す場合は以下の方式を検討する：

- 生徒専用レポート（個別共有は避け、Web UIまたは限定公開ページ）
- Looker Studio等を利用し、行レベルセキュリティを検討

## 10.2 複数教師・複数クラス

- Teacherロールを複数化する場合は、
  スプレッドシート／ドライブの共有設計を再検討する
- クラス管理（メンバー管理）を導入する場合は、
  role/permissionの粒度を拡張する

---

# 11. 受入基準との対応

本権限モデルは以下の受入基準に対応する：

- AC-NF-02 セキュリティ
  - 生徒はスプレッドシートへ直接アクセスできない
  - 教師のみ編集可能
  - Googleアカウント制限が有効

---

Author: Takeomi Tamura
Date: 2026/2/23
Version: 0.1