# Test Scenarios
## 一問一答フォーム作成・分析ツール（Phase1）

---

# 1. 本書の目的

本書は、MVP要件の受入判定に必要なテストシナリオを定義する。

- use-cases.md に基づき、正常系／異常系を網羅する
- acceptance-criteria.md の各項目にトレース可能とする
- Phase2以降のテスト観点表・受入テスト手順の母体とする

---

# 2. テスト範囲（Scope）

## 対象

- UC-01〜UC-06（MVPユースケース）
- 非機能：性能、セキュリティ、ログ／通知
- データ整合性：ID一意性、参照整合性、正規化保存

## 非対象（MVP外）

- IRT推定・高度分析
- クラス／メンバー管理機能
- WebアプリUI（フォーム中心のため）

---

# 3. 前提（共通）

- Googleフォームは「Googleアカウント必須」「メールアドレス収集ON」
- 複数回回答を許可
- 1問1点固定
- 生徒はスプレッドシートへアクセスできない
- 30名×10問程度のデータで検証する
- `.clasp.json` 等の機密情報はリポジトリに含めない

---

# 4. テストデータ（推奨セット）

## 問題セット

- Q1〜Q10：4択
- 正解はA/B/C/Dを混在
- タグは任意（例：TagA、TagB）

## アカウント

- Teacher：1アカウント（所有者）
- Student：少なくとも3アカウントで機能検証
- 性能検証：可能なら30アカウント相当の回答データ（手動またはスクリプト補助）

---

# 5. シナリオ一覧（Traceability）

| Scenario ID | 対応UC | 目的 | 対応AC |
|------------:|--------|------|--------|
| TS-01 | UC-01 | 問題登録（正常） | AC-01 |
| TS-02 | UC-01 | 問題登録（必須欠落） | AC-01 |
| TS-03 | UC-01 | 問題登録（正解不整合） | AC-01 |
| TS-04 | UC-02 | クイズ作成（正常） | AC-02 |
| TS-05 | UC-02 | クイズ作成（問題0件） | AC-02 |
| TS-06 | UC-02 | クイズ作成（重複選択） | AC-02 |
| TS-07 | UC-03 | フォーム生成（正常） | AC-03 |
| TS-08 | UC-03 | フォーム生成（紐付け欠落） | AC-03 |
| TS-09 | UC-04 | 回答受付（正常） | AC-04 |
| TS-10 | UC-04 | 複数回回答（同一アカウント） | AC-04, AC-05 |
| TS-11 | UC-05 | 自動採点（正誤・合計一致） | AC-05 |
| TS-12 | UC-05 | 採点時エラー（Question不明） | AC-05, AC-NF-03 |
| TS-13 | UC-06 | 集計（正答率・平均・一覧） | AC-06 |
| TS-14 | UC-06 | 集計（Attemptなし） | AC-06 |
| TS-15 | NFR | 性能（30×10） | AC-NF-01 |
| TS-16 | NFR | セキュリティ（生徒のシート不可視） | AC-NF-02 |
| TS-17 | NFR | ログ・通知（トリガー失敗） | AC-NF-03 |
| TS-18 | Data | ID一意性・参照整合性 | AC-05, AC-06 |

---

# 6. テストシナリオ詳細

以下、各シナリオは共通テンプレートで記述する：

- **目的**
- **前提**
- **手順**
- **期待結果**
- **トレース（UC / AC）**

---

## TS-01 問題登録（正常）

- **目的**：必須項目を満たす問題が登録できる
- **前提**：Teacherが編集権限を持つ
- **手順**
  1. Teacherが問題文・選択肢・正解を入力する
  2. 登録を実行する
- **期待結果**
  - Questionsに1行追加される
  - questionIdが付与される（重複なし）
- **トレース**：UC-01 / AC-01

---

## TS-02 問題登録（必須欠落）

- **目的**：必須欠落時に登録されない
- **手順**
  1. 選択肢を未入力（または問題文未入力）で登録する
- **期待結果**
  - 登録されない
  - 未入力項目が通知される
- **トレース**：UC-01 / AC-01

---

## TS-03 問題登録（正解不整合）

- **目的**：正解が選択肢に存在しない場合に拒否される
- **手順**
  1. 選択肢A〜Dを入力
  2. 正解に選択肢にない値を指定して登録
- **期待結果**
  - 登録されない
  - 整合性エラーが通知される
- **トレース**：UC-01 / AC-01

---

## TS-04 クイズ作成（正常）

- **目的**：10問のクイズが作成できる
- **前提**：Q1〜Q10が登録済み
- **手順**
  1. Teacherがタイトルを入力
  2. Q1〜Q10を選択
  3. 作成を実行
- **期待結果**
  - Quizzesに1行追加
  - QuizQuestionsに10行追加（displayOrder保持）
  - quizIdが付与（重複なし）
- **トレース**：UC-02 / AC-02

---

## TS-05 クイズ作成（問題0件）

- **目的**：問題未選択で作成できない
- **手順**
  1. タイトルのみ入力
  2. 問題を選択せず作成実行
- **期待結果**
  - 作成されない
  - 最低出題数要件が通知される
- **トレース**：UC-02 / AC-02

---

## TS-06 クイズ作成（重複選択）

- **目的**：同一Questionの重複選択時の挙動確認
- **手順**
  1. Q1を2回含めてクイズ作成操作
- **期待結果**
  - 仕様に従い「重複除外」または「エラー通知」
  - 最終的にQuizQuestionsで重複が発生しない
- **トレース**：UC-02 / AC-02

---

## TS-07 フォーム生成（正常）

- **目的**：クイズからフォームが生成できる
- **前提**：TS-04のQuizが存在
- **手順**
  1. TeacherがQuizを選択
  2. フォーム生成を実行
- **期待結果**
  - Googleフォームが生成される
  - フォームに10問が表示される
  - フォームURLが取得できる
  - 回答先スプレッドシートへ保存される
- **トレース**：UC-03 / AC-03

---

## TS-08 フォーム生成（紐付け欠落）

- **目的**：QuizQuestions不整合時に生成を防ぐ
- **前提**：意図的にQuizQuestionsを欠落させたQuizを用意（テスト環境のみ）
- **手順**
  1. 欠落したQuizでフォーム生成
- **期待結果**
  - 生成されない
  - 不備が通知される（ログ記録も推奨）
- **トレース**：UC-03 / AC-03

---

## TS-09 回答受付（正常）

- **目的**：生徒がGoogleアカウントで回答できる
- **前提**：フォームURLが配布済み
- **手順**
  1. Studentがフォームを開く
  2. 10問に回答して送信
- **期待結果**
  - フォーム回答が保存される
  - onFormSubmitが起動し採点へ進む（TS-11へ）
- **トレース**：UC-04 / AC-04

---

## TS-10 複数回回答（同一アカウント）

- **目的**：同一アカウントで複数回送信でき、履歴保存される
- **手順**
  1. Studentが1回目を送信
  2. 同一Studentが2回目を送信（回答を変える）
- **期待結果**
  - Attemptが2件保存される
  - AttemptAnswersも2回分保存される
- **トレース**：UC-04 / AC-04, AC-05

---

## TS-11 自動採点（正誤・合計一致）

- **目的**：正誤判定と合計得点が一致する
- **前提**：正解が既知の回答パターンを用意
- **手順**
  1. Studentが意図的に「正解5、誤答5」で送信
- **期待結果**
  - totalScore=5
  - AttemptAnswersのisCorrectが期待通り
  - 1問1点で計算される
- **トレース**：UC-05 / AC-05

---

## TS-12 採点時エラー（Question不明）

- **目的**：採点時に参照不能なQuestionが発生した場合のハンドリング
- **前提**：テスト環境で、フォーム設問とQuestionsの対応が崩れる状態を作る
- **手順**
  1. 対応不能な状態で送信
- **期待結果**
  - エラーがログに記録される
  - Teacherへ通知が飛ぶ
  - 不完全データが残る場合、検知可能である
- **トレース**：UC-05 / AC-NF-03

---

## TS-13 集計（正答率・平均・一覧）

- **目的**：集計が要件定義通りに算出される
- **前提**：複数Studentが回答済み
- **手順**
  1. Teacherが対象Quizの集計を表示する
- **期待結果**
  - 設問別正答率が表示される
  - 正答率=正答数/回答数（未回答は分母に含まれない）
  - Attempt単位平均点が表示される
  - 個人別得点一覧が取得できる
- **トレース**：UC-06 / AC-06

---

## TS-14 集計（Attemptなし）

- **目的**：Attemptが存在しない場合の表示
- **前提**：新規Quizで回答が0件
- **手順**
  1. Teacherが集計を表示
- **期待結果**
  - 空結果として表示される
  - エラーではない（未実施の旨を示す）
- **トレース**：UC-06 / AC-06

---

## TS-15 性能（30×10）

- **目的**：性能要件を満たす
- **手順**
  1. 30名相当×10問の回答データを投入（手動または補助スクリプト）
  2. 採点完了時間と集計反映時間を計測
- **期待結果**
  - 採点：10秒以内（目標）
  - 集計反映：30秒以内（目標）
- **トレース**：AC-NF-01

---

## TS-16 セキュリティ（生徒のシート不可視）

- **目的**：生徒がスプレッドシートへアクセスできない
- **手順**
  1. Studentが回答スプレッドシートURLへアクセスを試みる
- **期待結果**
  - アクセス拒否（権限なし）
  - 生徒はフォーム操作のみ可能
- **トレース**：AC-NF-02

---

## TS-17 ログ・通知（トリガー失敗）

- **目的**：トリガー失敗時にログ記録と教師通知が行われる
- **前提**：テスト環境で意図的に例外を発生させる（例：必須シート名変更）
- **手順**
  1. Studentが回答送信
- **期待結果**
  - ログが記録される
  - Teacherへ通知される
- **トレース**：AC-NF-03

---

## TS-18 データ整合性（ID一意性・参照整合性）

- **目的**：ID一意性と参照整合性が保たれる
- **手順**
  1. 複数のQuestion/Quiz/Attemptを作成
  2. questionId/quizId/attemptIdの重複がないことを確認
  3. AttemptAnswersが必ずAttemptと紐付くことを確認
- **期待結果**
  - ID重複なし
  - 参照不能なレコードが存在しない
- **トレース**：AC-05, AC-06

---

# 7. 終了条件（Exit Criteria）

以下を満たした場合、Phase1のテスト観点定義は完了とする：

- 全シナリオが acceptance-criteria.md とトレース可能
- 主要ユースケースの正常系・異常系が定義済み
- 性能・セキュリティ・ログ／通知の観点が含まれる
- データ整合性観点が含まれる

---

Author: Takeomi Tamura
Date: 2026/2/23
Version: 0.1